= Proof of Concept for federated, connected eID System for iOS

== Actors, Domains and Deep Links

=== Acme Administration
    acme.spilikin.dev
    id.acme.spilikin.dev
    appauth.acme.spilikin.dev

=== Foo Insurances
    foo.spilikin.dev
    id.foo.spilikin.dev
    appauth.foo.spilikin.dev

=== Bar Benefitial
    bar.spilikin.dev
    id.bar.spilikin.dev
    appauth.bar.spilikin.dev

=== Qux Medical
    qux.spilikin.dev

== Running locally

.Start HealthID API Server
----
cd healthid/api
source venv.sh
uvicorn healthid:app --reload
open http://localhost:8000/api/docs
http 'localhost:8000/api/auth/challenge?acct=99775533@healthid.life'
----

.Start UI Server
----
cd healthid/vue
yarn serve
open http://127.0.0.1:8080/SignIn
----


.Create Docker image
----
cd healthid
docker build . -t healthid
----

.Run Docker image
----
cd healthid
docker run -it -p 80:80 --rm healthid 
----

== Creating EC Key Pairs


[bash]
----
# create private key
openssl ecparam -genkey -name prime256v1 -noout -out private.pem
# generate public key
openssl ec -in private.pem -pubout -out public.pem
----

== Test the API

[bash]
----
# get challenge and redirect to Login-QR-Code page
http localhost:8000/api/auth/challenge acct==99775533@healthid.life redirect_uri==https://acme.spilikin.dev/ remote_auth_uri==https://appauth.acme.spilikin.dev/SignIn/Authenticate
# get challenge 
http localhost:8000/api/auth/challenge acct==99775533@healthid.life redirect_uri==https://acme.spilikin.dev/ 


http POST localhost:8000/api/auth/challenge acct=99775533@healthid.life alg="Unsigned" signature="" nonce=<nonce from previous request>
http -f POST localhost:8000/api/auth/token grant_type=authorization_code client_id=public_client redirect_uri=http://acme.spilikin.dev/ code=<code from previous request>

----
